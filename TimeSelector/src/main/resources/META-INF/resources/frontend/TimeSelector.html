<!-- Dependency resources -->
<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="PopupSelector.html">

<!-- Defines the example-template element -->
<dom-module id="time-selector">
    <template>
        <style>
            :host {
                --selector-font-size: 20px;
            }
            .time-selector {
                font-size: var(--selector-font-size);
            }
        </style>

        <label class="time-selector" on-click="_openCircle">[[value]]</label>
    </template>

    <!-- Polymer boilerplate to register the example-template element -->
    <script>
        class TimeSelector extends Polymer.Element {
            static get is() {
                return 'time-selector'
            }

            static get properties() {
                return {
                    value: {
                        type: String,
                        notify: true
                    },
                    open: {
                        type: Boolean,
                        value: false
                    },
                    hours: {
                        type: Boolean,
                        value: true
                    },
                    updating: {
                        type: Boolean,
                        value: false
                    }
                }
            }

            _openCircle() {
                var popup = new PopupSelector();
                document.body.appendChild(popup);
                popup.hours = this._parseHours();
                popup.minutes = this._parseMinutes();
                popup._populateString();
                popup._initializeCircle();

                popup.addEventListener('values', function () {
                    this._valueChange()
                }.bind(this));
            }

            _valueChange() {
                if (event) {
                    this._populateString(event.detail.hours, event.detail.minutes);
                }
            }

            // Parse the current minute value from the value string
            _parseMinutes() {
                return this.value.substring(this.value.indexOf(":") + 1, this.value.length);
            }

            // Parse the current hour value from the value string
            _parseHours() {
                return this.value.substring(0, this.value.indexOf(":"))
            }

            _populateString(hours, minutes) {
                if (hours.length < 2) {
                    hours = '0' + hours;
                }
                if (minutes.length < 2) {
                    minutes = '0' + minutes;
                }
                this.value = hours + ':' + minutes;
            }
        }

        customElements.define(TimeSelector.is, TimeSelector);

    </script>
</dom-module>
